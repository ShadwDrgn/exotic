<html>
    <head>
        <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons" rel="stylesheet" type="text/css">
        <link href="https://cdn.jsdelivr.net/npm/quasar@2.12.0/dist/quasar.prod.css" rel="stylesheet" type="text/css">
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <link href="/static/css/style.css" rel="stylesheet">
    </head>
<body>
    <div id="app">
        <q-toolbar class="bg-deep-purple-10"><q-toolbar-title><q-btn color="primary" label="The Exotic Zone"></q-btn></q-toolbar-title>
            <q-btn-dropdown color="primary" :label="current_character">
            </q-btn-dropdown>
        </q-toolbar>
        <div class="map" id="map">
            <div v-for="(tile, index) in tiles">
                <div @mouseover="desc=tile.desc" @click="character_move(tile.x, tile.y)" class="tile" :class="[tile.tile_type]"><span style="position:absolute;">{{ tile.x }}, {{ tile.y }}</span>
                    <q-icon v-if="index == 12" class="ma-auto" color="yellow" name="person"></q-icon>
                </div>
            </div>
        </div>
        <div id="description">{{ desc }}</div>
    </div>
    <div class="resource-orb" style="background: linear-gradient(to top, red, red 50%, transparent 50%, transparent 100%);bottom: 10px;left:20%;"></div>
    <div class="resource-orb" style="background: linear-gradient(to top, blue, blue 30%, transparent 30%, transparent 100%);bottom: 10px;right:20%;"></div>

    
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quasar@2.12.0/dist/quasar.umd.prod.js"></script>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const current_character = urlParams.get('char');
        const app = Vue.createApp({
            data() {
              return { 
                  tiles: null,
                  desc: null,
                  current_character: urlParams.get('char')
              }
            },
            methods: {
                character_move(x, y) {
                    axios.get('/move', { params: {char: current_character, x: x, y: y}}).then(response => {
                        this.tiles = response.data.sort((tilea, tileb) => tilea.y - tileb.y || tilea.x - tileb.x);
                    });
                }
            },
            mounted() {
                axios.get('/tiles?char=' + current_character).then(response => {
                    this.tiles = response.data.sort((tilea, tileb) => tilea.y - tileb.y || tilea.x - tileb.x);;
                });
            }
        }).use(Quasar).mount('#app');
    </script>
</body>
</html>
